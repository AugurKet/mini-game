<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Astigmatism Dial + Quick Check</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  :root{
    --bg:#0f172a; --panel:#020617; --ink:#e5e7eb; --muted:#94a3b8;
    --line:#1f2a44; --btn:#2563eb; --btn2:#334155; --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
  }
  body{
    margin:0; background:var(--bg); color:var(--ink); font-family:Arial, sans-serif;
    display:flex; justify-content:center; align-items:center; min-height:100vh;
  }
  .wrap{
    width:440px; background:var(--panel); border-radius:14px; padding:14px;
    box-shadow:0 15px 40px rgba(0,0,0,.6);
  }
  h2{ margin:6px 0 6px; text-align:center; }
  .sub{ margin:0 0 12px; text-align:center; color:var(--muted); font-size:13px; line-height:1.35; }
  .row{ display:flex; gap:10px; flex-wrap:wrap; }
  .pill{
    background:#0b1224; border:1px solid var(--line); padding:8px 10px; border-radius:12px; font-size:13px;
    flex:1; min-width:150px;
  }
  .pill b{ color:#fff; }
  .panel{
    background:#0b1224; border:1px solid var(--line); border-radius:12px; padding:12px; margin-top:10px;
  }
  .panel h3{ margin:0 0 8px; font-size:15px; }
  .panel p, .panel li, label{ color:var(--muted); font-size:13px; line-height:1.45; }
  canvas{ width:100%; height:auto; background:#fff; border-radius:12px; display:block; }
  .controls{ display:flex; gap:10px; margin-top:10px; }
  button, select, input[type="range"]{
    border-radius:10px; border:1px solid var(--line); background:#0b1224; color:var(--ink);
    padding:10px 10px; font-size:14px;
  }
  button{ cursor:pointer; border:none; background:var(--btn); flex:1; }
  button.secondary{ background:var(--btn2); }
  .q{
    display:flex; gap:10px; align-items:center; justify-content:space-between; padding:8px 0; border-bottom:1px solid rgba(255,255,255,.06);
  }
  .q:last-child{ border-bottom:none; }
  .q .left{ flex:1; }
  .q .right{ display:flex; gap:8px; }
  .radio{
    display:inline-flex; gap:6px; align-items:center; padding:6px 8px; border-radius:999px;
    border:1px solid rgba(255,255,255,.10); cursor:pointer; user-select:none;
  }
  .radio input{ display:none; }
  .radio.on{ border-color:#60a5fa; background:#0b224a; color:#dbeafe; }
  .tagrow{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  .tag{
    padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid var(--line); background:#071022; color:var(--muted);
  }
  .tag.ok{ border-color:#14532d; background:#052013; color:#bbf7d0; }
  .tag.warn{ border-color:#7c5f00; background:#221a05; color:#fde68a; }
  .tag.bad{ border-color:#7f1d1d; background:#220707; color:#fecaca; }
  .small{ font-size:12px; color:var(--muted); }
  .divider{ height:1px; background:rgba(255,255,255,.08); margin:10px 0; }
</style>
</head>
<body>

<div class="wrap">
  <h2>Astigmatism Dial</h2>
  <div class="sub">
    Screening tool only. Test each eye separately: cover one eye (don’t press it), look at the center dot.
  </div>

  <div class="row">
    <div class="pill">Eye: <b id="eyeLabel">Both (demo)</b></div>
    <div class="pill">Darkest lines: <b id="darkAns">—</b></div>
  </div>

  <div class="panel">
    <h3>1) The Dial</h3>
    <p>
      Instructions: Sit ~40cm from the screen. Increase brightness (avoid Night Shift / blue filter).
      Look at the center dot. Do <b>some lines look darker/sharper</b> than others?
    </p>

    <canvas id="dial" width="900" height="900" aria-label="Astigmatism dial"></canvas>

    <div class="controls">
      <select id="eye">
        <option value="demo" selected>Both (demo)</option>
        <option value="left">Left eye only</option>
        <option value="right">Right eye only</option>
      </select>
      <button class="secondary" id="redraw">Redraw</button>
    </div>

    <div class="divider"></div>

    <label class="small">
      If some lines look darker, pick the angle range that looks darkest:
    </label>
    <div class="controls" style="margin-top:8px;">
      <select id="darkest">
        <option value="">Select…</option>
        <option value="0">Around 0° / 180° (horizontal)</option>
        <option value="45">Around 45° / 225° (diagonal)</option>
        <option value="90">Around 90° / 270° (vertical)</option>
        <option value="135">Around 135° / 315° (diagonal)</option>
        <option value="mixed">Different each time / not sure</option>
        <option value="none">All lines look similar</option>
      </select>
      <button id="saveDial">Save</button>
    </div>

    <p class="small" style="margin-top:8px;">
      Tip: If one direction is consistently darker on one eye but not the other, that’s more meaningful than a one-off try.
    </p>
  </div>

  <div class="panel">
    <h3>2) Quick Questionnaire</h3>

    <div class="q" data-q="blur">
      <div class="left">Do you often notice blurry vision at distance or reading?</div>
      <div class="right"></div>
    </div>

    <div class="q" data-q="ghost">
      <div class="left">Do letters/lines look doubled, shadowed, or “ghosted”?</div>
      <div class="right"></div>
    </div>

    <div class="q" data-q="strain">
      <div class="left">Do you get eye strain or headaches after screen/reading?</div>
      <div class="right"></div>
    </div>

    <div class="q" data-q="night">
      <div class="left">Do you struggle with night driving (glare/halos)?</div>
      <div class="right"></div>
    </div>

    <div class="q" data-q="squint">
      <div class="left">Do you squint frequently to see clearly?</div>
      <div class="right"></div>
    </div>

    <div class="controls">
      <button id="getResult">Get Result</button>
      <button class="secondary" id="resetAll">Reset All</button>
    </div>

    <div class="tagrow" id="tags"></div>
    <p id="interpret" style="margin-top:8px;">Answer the questions and press <b>Get Result</b>.</p>
    <p class="small">
      If you have sudden vision changes, pain, flashes/floaters, or one eye is dramatically different, seek prompt professional care.
    </p>
  </div>

  <div class="panel">
    <h3>How to Interpret (Simple)</h3>
    <ul>
      <li><b>All lines similar</b> + few symptoms → usually reassuring.</li>
      <li><b>Some lines consistently darker</b> in one eye + symptoms → consider an eye exam for astigmatism/vision check.</li>
      <li>Results depend on screen/brightness. Repeat on the same device and compare left vs right.</li>
    </ul>
  </div>
</div>

<script>
  // ---------- Dial Drawing ----------
  const canvas = document.getElementById("dial");
  const ctx = canvas.getContext("2d");
  const eyeEl = document.getElementById("eye");
  const redrawBtn = document.getElementById("redraw");

  const darkestSel = document.getElementById("darkest");
  const saveDialBtn = document.getElementById("saveDial");
  const darkAnsEl = document.getElementById("darkAns");
  const eyeLabelEl = document.getElementById("eyeLabel");

  function drawDial(){
    const w = canvas.width, h = canvas.height;
    ctx.clearRect(0,0,w,h);

    // white background
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0,0,w,h);

    const cx = w/2, cy = h/2;
    const R = Math.min(w,h) * 0.45;

    // outer circle
    ctx.strokeStyle = "#000";
    ctx.lineWidth = 6;
    ctx.beginPath();
    ctx.arc(cx, cy, R, 0, Math.PI*2);
    ctx.stroke();

    // inner circle
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(cx, cy, R*0.55, 0, Math.PI*2);
    ctx.stroke();

    // lines
    ctx.strokeStyle = "#000";
    for(let deg=0; deg<180; deg+=15){
      const rad = deg * Math.PI/180;

      // slight random tiny variation so it doesn't look "perfectly identical" to everyone,
      // but still consistent enough for repeated testing.
      const jitter = (Math.random()-0.5)*0.5;
      const a = rad + jitter;

      const x1 = cx + Math.cos(a)*R;
      const y1 = cy + Math.sin(a)*R;
      const x2 = cx - Math.cos(a)*R;
      const y2 = cy - Math.sin(a)*R;

      ctx.lineWidth = (deg % 45 === 0) ? 4 : 2.5;
      ctx.beginPath();
      ctx.moveTo(x1,y1);
      ctx.lineTo(x2,y2);
      ctx.stroke();
    }

    // center dot
    ctx.fillStyle = "#000";
    ctx.beginPath();
    ctx.arc(cx, cy, 10, 0, Math.PI*2);
    ctx.fill();

    // angle labels (0/90/180/270)
    ctx.fillStyle = "#000";
    ctx.font = "bold 36px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("0°",   cx, cy - R - 40);
    ctx.fillText("90°",  cx + R + 55, cy);
    ctx.fillText("180°", cx, cy + R + 45);
    ctx.fillText("270°", cx - R - 60, cy);
  }

  // ---------- Questionnaire ----------
  const questions = ["blur","ghost","strain","night","squint"];
  const tagBox = document.getElementById("tags");
  const interpretEl = document.getElementById("interpret");
  const getResultBtn = document.getElementById("getResult");
  const resetAllBtn = document.getElementById("resetAll");

  const state = {
    eye: "demo",
    dialDarkest: "",
    answers: { blur:null, ghost:null, strain:null, night:null, squint:null }
  };

  function setEyeLabel(){
    const v = state.eye;
    eyeLabelEl.textContent =
      v === "left" ? "Left eye only" :
      v === "right" ? "Right eye only" :
      "Both (demo)";
  }

  function renderRadios(){
    document.querySelectorAll(".q").forEach(row => {
      const key = row.dataset.q;
      const right = row.querySelector(".right");
      right.innerHTML = "";

      ["No","Sometimes","Yes"].forEach((label, idx) => {
        const val = idx; // 0/1/2
        const pill = document.createElement("label");
        pill.className = "radio" + (state.answers[key] === val ? " on" : "");
        pill.innerHTML = `<input type="radio" name="${key}" value="${val}"> ${label}`;
        pill.addEventListener("click", () => {
          state.answers[key] = val;
          renderRadios();
        });
        right.appendChild(pill);
      });
    });
  }

  function setTag(kind, text){
    const span = document.createElement("span");
    span.className = `tag ${kind}`;
    span.textContent = text;
    tagBox.appendChild(span);
  }

  function summarize(){
    tagBox.innerHTML = "";

    // score answers: No=0 Sometimes=1 Yes=2
    const scores = questions.map(k => state.answers[k]);
    const unanswered = scores.filter(v => v === null).length;

    if (unanswered > 0){
      setTag("warn", `Unanswered: ${unanswered}`);
      interpretEl.textContent = "Please answer all questions for a better summary.";
      return;
    }

    const symptomScore = scores.reduce((a,b)=>a+b,0); // 0..10
    const dial = state.dialDarkest;

    // Dial weight:
    // none = reassuring, mixed/empty = unknown, any angle = suggestive
    let dialFlag = 0; // 0=none,1=unknown,2=suggestive
    if (!dial) dialFlag = 1;
    else if (dial === "none") dialFlag = 0;
    else if (dial === "mixed") dialFlag = 1;
    else dialFlag = 2;

    // Interpretation bands (screening, gentle)
    let band = "Low concern";
    let kind = "ok";

    // combine
    // high symptoms OR suggestive dial pushes concern up
    if (symptomScore >= 7 || (symptomScore >= 4 && dialFlag === 2)){
      band = "Higher likelihood (screening)";
      kind = "bad";
    } else if (symptomScore >= 4 || dialFlag === 2){
      band = "Possible astigmatism / vision issue";
      kind = "warn";
    } else if (dialFlag === 1){
      band = "Inconclusive (repeat test)";
      kind = "warn";
    }

    setTag(kind, band);
    setTag("tag", `Symptoms score: ${symptomScore}/10`);
    setTag("tag", `Eye: ${state.eye === "demo" ? "both" : state.eye}`);

    if (!state.dialDarkest){
      setTag("warn","Dial: not saved");
    } else {
      const map = {
        "0":"Dial: darkest ~horizontal",
        "45":"Dial: darkest ~45°",
        "90":"Dial: darkest ~vertical",
        "135":"Dial: darkest ~135°",
        "mixed":"Dial: inconsistent",
        "none":"Dial: all similar"
      };
      setTag("tag", map[state.dialDarkest] || "Dial: saved");
    }

    // Guidance text
    let text =
      `This is not a diagnosis. Based on your responses, the result is: ${band}. `;

    if (kind === "ok"){
      text += "If you’re comfortable and lines look similar, that’s generally reassuring. Retest if you change screen settings or feel eye strain.";
    } else if (band.includes("Inconclusive")){
      text += "Try again with higher brightness, no blue filter, and steady distance. Test each eye separately and compare results.";
    } else if (kind === "warn"){
      text += "If one eye consistently shows darker lines in a certain direction and you have symptoms, an eye exam can clarify (astigmatism is common and correctable).";
    } else {
      text += "If symptoms are frequent or affecting daily life (especially night glare/ghosting), consider a professional eye exam soon. Seek prompt care if symptoms are sudden or severe.";
    }

    interpretEl.textContent = text;
  }

  // ---------- Events ----------
  eyeEl.addEventListener("change", () => {
    state.eye = eyeEl.value;
    setEyeLabel();
  });

  redrawBtn.addEventListener("click", drawDial);

  saveDialBtn.addEventListener("click", () => {
    state.dialDarkest = darkestSel.value;
    const map = {
      "0":"Horizontal (0°/180°)",
      "45":"Diagonal (45°/225°)",
      "90":"Vertical (90°/270°)",
      "135":"Diagonal (135°/315°)",
      "mixed":"Inconsistent / not sure",
      "none":"All similar"
    };
    darkAnsEl.textContent = map[state.dialDarkest] || "—";
  });

  getResultBtn.addEventListener("click", summarize);

  resetAllBtn.addEventListener("click", () => {
    state.eye = "demo";
    state.dialDarkest = "";
    questions.forEach(k => state.answers[k] = null);
    eyeEl.value = "demo";
    darkestSel.value = "";
    darkAnsEl.textContent = "—";
    setEyeLabel();
    renderRadios();
    tagBox.innerHTML = "";
    interpretEl.textContent = "Answer the questions and press Get Result.";
    drawDial();
  });

  // init
  setEyeLabel();
  renderRadios();
  drawDial();
</script>

</body>
</html>
